<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SEC Arena Financial Tracker</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root { --primary: #2c3e50; --accent: #e74c3c; --bg: #f4f7f6; }
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; background: var(--bg); margin: 0; padding: 20px; color: #333; }
        .container { max-width: 900px; margin: 0 auto; }
        
        header { text-align: center; margin-bottom: 30px; }
        h1 { margin: 0; color: var(--primary); }
        p.subtitle { color: #666; font-size: 0.9rem; margin-top: 5px; }

        /* Section Titles */
        .section-title { font-size: 0.8rem; text-transform: uppercase; letter-spacing: 1px; color: #7f8c8d; margin-bottom: 10px; margin-top: 30px; font-weight: bold; }

        /* Grid Layouts */
        .rate-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; margin-bottom: 20px; }
        .impact-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; margin-bottom: 30px; }

        /* Cards */
        .card { background: white; padding: 15px; border-radius: 10px; box-shadow: 0 2px 4px rgba(0,0,0,0.05); text-align: center; }
        .card h3 { margin: 0 0 5px 0; font-size: 0.85rem; color: #7f8c8d; }
        .card .value { font-size: 1.5rem; font-weight: bold; color: var(--primary); }
        .card .sub-value { font-size: 0.75rem; color: #95a5a6; margin-top: 3px; }
        
        /* Specific Card Styles */
        .card.highlight .value { color: #2980b9; } /* Blue for Debenture Rate */
        .card.danger .value { color: var(--accent); } /* Red for Costs */

        /* Chart */
        .chart-container { background: white; padding: 20px; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.05); }

        /* Mobile Responsive */
        @media (max-width: 600px) {
            .rate-grid, .impact-grid { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>

<div class="container">
    <header>
        <h1>Brantford SEC Arena Tracker</h1>
        <p class="subtitle">Tracking the impact of interest rates on the $140M Debenture</p>
    </header>

    <div class="section-title">The Interest Rate Formula</div>
    <div class="rate-grid">
        <div class="card">
            <h3>Canada 30yr Bond</h3>
            <div class="value" id="bond-yield">--%</div>
            <div class="sub-value">Base Market Rate</div>
        </div>
        <div class="card">
            <h3>+ Municipal Spread</h3>
            <div class="value" id="spread">1.10%</div>
            <div class="sub-value">Risk Premium (Est.)</div>
        </div>
        <div class="card highlight">
            <h3>= Debenture Rate</h3>
            <div class="value" id="total-rate">--%</div>
            <div class="sub-value">Total Interest Rate</div>
        </div>
    </div>

    <div class="section-title">Community Impact</div>
    <div class="impact-grid">
        <div class="card danger">
            <h3>Total Interest Cost</h3>
            <div class="value" id="total-interest">$--</div>
            <div class="sub-value">Over 30 Year Term</div>
        </div>
        <div class="card danger">
            <h3>Household Impact</h3>
            <div class="value" id="household-impact">$--</div>
            <div class="sub-value">Per Year (Est.)</div>
        </div>
    </div>

    <div class="chart-container">
        <canvas id="rateChart"></canvas>
    </div>
</div>

<script>
    async function fetchData() {
        try {
            const response = await fetch('./interest_rate_log.csv');
            const data = await response.text();
            
            const rows = data.split('\n').slice(1).filter(row => row.trim() !== '');
            const dates = [];
            const costs = [];
            const debentureRates = []; // For the graph
            let last = {};

            rows.forEach(row => {
                const c = row.split(',');
                // CSV Columns: 0=Date, 1=BondYield, 2=TotalRate, 3=AnnualPay, 4=TotalInterest, 5=Household
                dates.push(c[0]);
                debentureRates.push(parseFloat(c[2])); // Graphing the full rate
                costs.push(parseFloat(c[4]));
                
                last = { 
                    yield: c[1], 
                    totalRate: c[2], 
                    interest: parseFloat(c[4]), 
                    impact: parseFloat(c[5]) 
                };
            });

            // Update Text Cards
            document.getElementById('bond-yield').innerText = last.yield + '%';
            document.getElementById('total-rate').innerText = last.totalRate + '%';
            document.getElementById('total-interest').innerText = '$' + (last.interest / 1000000).toFixed(1) + 'M';
            document.getElementById('household-impact').innerText = '$' + last.impact;

            // Draw Chart
            const ctx = document.getElementById('rateChart').getContext('2d');
            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: dates,
                    datasets: [{
                        label: 'Total Interest Cost (Millions)',
                        data: costs.map(c => c / 1000000),
                        borderColor: '#e74c3c', // Red
                        backgroundColor: 'rgba(231, 76, 60, 0.1)',
                        yAxisID: 'y',
                        fill: true
                    }, {
                        label: 'Debenture Rate (%)',
                        data: debentureRates,
                        borderColor: '#2980b9', // Blue
                        borderDash: [5, 5],
                        yAxisID: 'y1',
                        fill: false
                    }]
                },
                options: {
                    responsive: true,
                    interaction: { mode: 'index', intersect: false },
                    scales: {
                        y: { 
                            type: 'linear', display: true, position: 'left', 
                            title: { display: true, text: 'Cost ($ Millions)' } 
                        },
                        y1: { 
                            type: 'linear', display: true, position: 'right', grid: { drawOnChartArea: false },
                            title: { display: true, text: 'Interest Rate (%)' } 
                        }
                    }
                }
            });
        } catch (e) { console.error("Error loading data:", e); }
    }

    fetchData();
</script>

</body>
</html>
